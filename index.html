<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
    <title>AssetFlow – PTB Dashboard</title>
    
    <!-- 1. Styles -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- 2. Tailwind Configuration -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
            colors: {
              primary: '#1a1a2e',
              secondary: '#16162a',
              accent1: '#d13197',
              accent2: '#7070ff',
              success: '#0cb981',
              warning: '#f59e0b',
              danger: '#ef4444',
            },
            animation: {
              'pulse-fast': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
              'fade-in': 'fadeIn 0.3s ease-out',
              'slide-up': 'slideUp 0.3s ease-out',
            },
            keyframes: {
              fadeIn: {
                '0%': { opacity: '0' },
                '100%': { opacity: '1' },
              },
              slideUp: {
                '0%': { transform: 'translateY(20px)', opacity: '0' },
                '100%': { transform: 'translateY(0)', opacity: '1' },
              }
            }
          }
        }
      }
    </script>

    <style>
      body {
        background: linear-gradient(135deg, #0f0f1e 0%, #1a1a2e 100%);
        color: #e5e7eb;
        -webkit-tap-highlight-color: transparent;
      }
      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb {
        background: rgba(112, 112, 255, 0.3);
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: rgba(112, 112, 255, 0.5);
      }
      .glass-card {
        background: linear-gradient(135deg, rgba(26, 26, 46, 0.9), rgba(22, 22, 42, 0.9));
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.05);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.35);
      }
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
    </style>

    <!-- 3. React & Libraries (Global UMD) -->
    <!-- React MUST be loaded first -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <!-- Recharts depends on React -->
    <script crossorigin src="https://unpkg.com/recharts@2.12.3/umd/Recharts.min.js"></script>
    
    <!-- 4. Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 5. Import Map for GenAI (ESM Only) -->
    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.run/@google/genai",
    "react": "https://aistudiocdn.com/react@^19.2.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.1/",
    "react/": "https://aistudiocdn.com/react@^19.2.1/",
    "recharts": "https://aistudiocdn.com/recharts@^3.5.1"
  }
}
</script>
  </head>
  <body>
    <div id="root"></div>

    <!-- MAIN APPLICATION SCRIPT -->
    <script type="text/babel" data-type="module">
      import { GoogleGenAI } from "@google/genai";

      // --- CONFIGURATION & GLOBALS ---
      // IMPORTANT: Replace with your actual Gemini API Key
      window.process = {
        env: {
          API_KEY: 'YOUR_GEMINI_API_KEY_HERE' 
        }
      };

      // Access Globals explicitly to avoid ESM/UMD conflicts
      const React = window.React;
      const ReactDOM = window.ReactDOM;
      const Recharts = window.Recharts;

      const { useState, useEffect, useRef } = React;
      const { 
        AreaChart, Area, XAxis, YAxis, Tooltip, ResponsiveContainer, BarChart, Bar 
      } = Recharts;

      // --- TYPES & CONSTANTS ---
      const SYMBOL_CONFIG = {
        bitcoin: { cg: "bitcoin", binance: "btcusdt", label: "BTC/USD", icon: "BTC" },
        ethereum: { cg: "ethereum", binance: "ethusdt", label: "ETH/USD", icon: "ETH" },
        tether: { cg: "tether", binance: null, label: "USDT/USD", icon: "USDT" },
        binancecoin: { cg: "binancecoin", binance: "bnbusdt", label: "BNB/USD", icon: "BNB" },
        solana: { cg: "solana", binance: "solusdt", label: "SOL/USD", icon: "SOL" }
      };

      const PLANS = [
        { id: 'profit-guard', name: 'Profit-Guard', rate: 0.03, min: 200, max: 2999, days: 3, desc: 'Entry level quick turn' },
        { id: 'wealth-guard', name: 'Wealth-Guard', rate: 0.05, min: 3000, max: 20000, days: 5, desc: 'Balanced growth' },
        { id: 'binance-max', name: 'Binance Max', rate: 0.07, min: 20000, max: 999999, days: 130, desc: 'Long term scaling' },
      ];

      // --- SERVICES ---
      
      const CG_BASE_URL = 'https://api.coingecko.com/api/v3';
      
      const generateFallbackData = (daysStr) => {
        const now = Date.now();
        const days = parseInt(daysStr);
        const data = [];
        let price = 50000;
        
        for (let i = 0; i < 100; i++) {
          const time = now - (days * 24 * 60 * 60 * 1000) + (i * (days * 24 * 60 * 60 * 10));
          const volatility = price * 0.02;
          const change = (Math.random() - 0.5) * volatility;
          
          data.push({
            time,
            open: price,
            high: price + Math.abs(change),
            low: price - Math.abs(change),
            close: price + change,
            volume: Math.random() * 500 + 100
          });
          price += change;
        }
        return data;
      };

      const fetchHistoricalData = async (symbol, timeframe) => {
        const cfg = SYMBOL_CONFIG[symbol];
        
        let days = '1';
        if (timeframe === '1h') days = '7';
        if (timeframe === '4h') days = '30';

        try {
          const response = await fetch(`${CG_BASE_URL}/coins/${cfg.cg}/ohlc?vs_currency=usd&days=${days}`);
          
          if (!response.ok) {
            console.warn('Rate limit hit or API error, generating fallback data');
            return generateFallbackData(days);
          }

          const data = await response.json();
          return data.map((d) => ({
            time: d[0],
            open: d[1],
            high: d[2],
            low: d[3],
            close: d[4],
            volume: Math.random() * 1000 // Synthetic volume
          }));
        } catch (error) {
          console.error("Error fetching historical data", error);
          return generateFallbackData(days);
        }
      };

      const getMarketInsight = async (symbol, price, change24h) => {
        const apiKey = window.process.env.API_KEY;
        
        const generateOfflineInsight = (sym, change) => {
            const trend = change >= 0 ? "bullish" : "bearish";
            const action = change >= 0 ? "accumulating" : "consolidating";
            return `${sym.toUpperCase()} is showing ${trend} momentum with market participants ${action} at current levels. Volatility remains expected in the short term.`;
        };

        if (!apiKey || apiKey === 'YOUR_GEMINI_API_KEY_HERE') {
            return generateOfflineInsight(symbol, change24h);
        }

        try {
            const ai = new GoogleGenAI({ apiKey });
            const prompt = `
            Analyze the current market for ${symbol}. 
            Current Price: $${price}. 
            24h Change: ${change24h}%. 
            
            Provide a 2-sentence concise trading insight for a dashboard. 
            Focus on technical sentiment (Bullish/Bearish) and a key support/resistance level.
            Do not include "Here is the insight" or similar preambles.
            `;

            const response = await ai.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: prompt,
            });

            return response.text || generateOfflineInsight(symbol, change24h);
        } catch (error) {
            console.error("Gemini API Error:", error);
            return generateOfflineInsight(symbol, change24h);
        }
      };

      // --- COMPONENTS ---

      // 1. Market Chart
      const MarketChart = ({ data, loading, color }) => {
        if (loading) {
          return (
            <div className="h-full w-full flex items-center justify-center">
              <div className="w-10 h-10 border-4 border-accent2 border-t-transparent rounded-full animate-spin"></div>
            </div>
          );
        }

        if (!data || data.length === 0) {
          return (
            <div className="h-full w-full flex items-center justify-center text-gray-500">
              No Data Available
            </div>
          );
        }

        const formatYAxis = (tickItem) => `$${tickItem.toLocaleString(undefined, { maximumFractionDigits: 0 })}`;
        const minPrice = Math.min(...data.map(d => d.low)) * 0.99;
        const maxPrice = Math.max(...data.map(d => d.high)) * 1.01;

        return (
          <div className="flex flex-col h-full w-full">
            <div className="flex-grow h-[70%]">
              <ResponsiveContainer width="100%" height="100%">
                <AreaChart data={data}>
                  <defs>
                    <linearGradient id="colorPrice" x1="0" y1="0" x2="0" y2="1">
                      <stop offset="5%" stopColor={color} stopOpacity={0.3}/>
                      <stop offset="95%" stopColor={color} stopOpacity={0}/>
                    </linearGradient>
                  </defs>
                  <XAxis dataKey="time" hide={true} />
                  <YAxis 
                    domain={[minPrice, maxPrice]} 
                    orientation="right" 
                    tick={{fill: '#9ca3af', fontSize: 11}}
                    tickFormatter={formatYAxis}
                    axisLine={false}
                    tickLine={false}
                  />
                  <Tooltip 
                    contentStyle={{ backgroundColor: '#1a1a2e', borderColor: 'rgba(255,255,255,0.1)', color: '#fff' }}
                    itemStyle={{ color: '#fff' }}
                    labelFormatter={(label) => new Date(label).toLocaleString()}
                    formatter={(value) => [`$${value.toFixed(2)}`, 'Price']}
                  />
                  <Area 
                    type="monotone" 
                    dataKey="close" 
                    stroke={color} 
                    fillOpacity={1} 
                    fill="url(#colorPrice)" 
                    strokeWidth={2}
                  />
                </AreaChart>
              </ResponsiveContainer>
            </div>
            <div className="h-[30%] -mt-4 opacity-50">
              <ResponsiveContainer width="100%" height="100%">
                <BarChart data={data}>
                  <Bar dataKey="volume" fill={color} />
                </BarChart>
              </ResponsiveContainer>
            </div>
          </div>
        );
      };

      // 2. Calculator
      const Calculator = () => {
        const [selectedPlanId, setSelectedPlanId] = useState('profit-guard');
        const [amount, setAmount] = useState(5000);
        const [results, setResults] = useState({ daily: 0, total: 0, return: 0 });

        useEffect(() => {
          const plan = PLANS.find(p => p.id === selectedPlanId) || PLANS[0];
          const safeAmount = Math.max(0, amount);
          
          const dailyProfit = safeAmount * plan.rate;
          const totalProfit = dailyProfit * plan.days;
          const totalReturn = safeAmount + totalProfit;

          setResults({
            daily: dailyProfit,
            total: totalProfit,
            return: totalReturn
          });
        }, [selectedPlanId, amount]);

        const handleDownload = () => {
          const plan = PLANS.find(p => p.id === selectedPlanId);
          const content = `AssetFlow PTB Calculation\n\nInvestment: $${amount}\nPlan: ${plan?.name}\nDaily Profit: $${results.daily.toFixed(2)}\nTotal Return: $${results.return.toFixed(2)}\n\nDate: ${new Date().toLocaleString()}`;
          const blob = new Blob([content], { type: 'text/plain' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `assetflow-calc-${Date.now()}.txt`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
        };

        return (
          <div className="glass-card rounded-2xl p-5 h-full flex flex-col hover:-translate-y-1 transition-transform duration-300">
            <div className="flex justify-between items-center mb-5">
              <h2 className="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-accent1 to-accent2">
                PTB Profit Calculator
              </h2>
              <button 
                onClick={handleDownload}
                className="w-9 h-9 flex items-center justify-center rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 hover:rotate-12 transition-all"
                title="Download Results"
              >
                <i className="fas fa-download text-gray-400"></i>
              </button>
            </div>

            <div className="grid grid-cols-1 sm:grid-cols-3 gap-3 mb-5">
              {PLANS.map((plan) => (
                <div 
                  key={plan.id}
                  onClick={() => setSelectedPlanId(plan.id)}
                  className={`
                    relative p-3 rounded-xl border cursor-pointer transition-all overflow-hidden
                    ${selectedPlanId === plan.id 
                      ? 'bg-accent1/10 border-accent1 before:absolute before:top-0 before:left-0 before:w-full before:h-1 before:bg-gradient-to-r before:from-accent1 before:to-accent2' 
                      : 'bg-white/5 border-white/10 hover:bg-white/10 hover:-translate-y-1'}
                  `}
                >
                  <div className="font-bold text-sm mb-1">{plan.name}</div>
                  <div className="text-lg font-extrabold text-accent1 mb-1">{(plan.rate * 100).toFixed(0)}% <span className="text-xs font-normal text-gray-400">Daily</span></div>
                  <div className="text-xs text-gray-400">{plan.days} Days</div>
                </div>
              ))}
            </div>

            <div className="mb-5">
              <label className="block text-sm font-semibold text-gray-400 mb-2">Investment Amount ($)</label>
              <input 
                type="number" 
                value={amount}
                onChange={(e) => setAmount(parseFloat(e.target.value))}
                className="w-full bg-white/5 border border-white/20 rounded-xl p-4 text-white focus:outline-none focus:border-accent1 focus:ring-2 focus:ring-accent1/20 transition-all font-sans text-lg"
                placeholder="5000"
                min="200"
              />
            </div>

            <div className="mt-auto bg-accent1/5 border border-accent1/20 rounded-xl p-5 space-y-3">
              <div className="flex justify-between items-center border-b border-white/5 pb-2">
                <span className="text-sm text-gray-400">Daily Profit</span>
                <span className="font-semibold">${results.daily.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
              </div>
              <div className="flex justify-between items-center border-b border-white/5 pb-2">
                <span className="text-sm text-gray-400">Total Profit</span>
                <span className="font-semibold">${results.total.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
              </div>
              <div className="flex justify-between items-center pt-1">
                <span className="text-sm text-gray-400">Total Return</span>
                <span className="text-lg font-bold text-accent1">${results.return.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
              </div>
            </div>
          </div>
        );
      };

      // 3. Suggestion Box
      const SuggestionBox = ({ asset, insight, trend }) => {
        return (
          <div className="col-span-1 lg:col-span-2 bg-[#7070ff]/10 border border-[#7070ff]/30 rounded-2xl p-5 mb-6">
            <div className="flex items-center gap-2 mb-4">
              <i className="fas fa-lightbulb text-accent2 text-lg"></i>
              <h3 className="text-lg font-bold text-white">Gemini Smart Insight</h3>
            </div>
            
            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
              <div className="bg-white/5 p-4 rounded-lg hover:bg-white/10 transition-all">
                <div className="text-xs text-gray-400 mb-1 font-medium">Focus Asset</div>
                <div className="text-base font-bold text-white">{asset}</div>
              </div>
              
              <div className="bg-white/5 p-4 rounded-lg hover:bg-white/10 transition-all">
                <div className="text-xs text-gray-400 mb-1 font-medium">Market Trend</div>
                <div className={`text-base font-bold ${trend === 'bullish' ? 'text-success' : trend === 'bearish' ? 'text-danger' : 'text-warning'}`}>
                  {trend.charAt(0).toUpperCase() + trend.slice(1)}
                </div>
              </div>
              
              <div className="col-span-1 md:col-span-2 bg-white/5 p-4 rounded-lg hover:bg-white/10 transition-all">
                <div className="text-xs text-gray-400 mb-1 font-medium">AI Analysis</div>
                <div className="text-sm font-medium leading-relaxed text-gray-200">
                  {insight}
                </div>
              </div>
            </div>
          </div>
        );
      };

      // 4. Modal
      const Modal = ({ isOpen, onClose, title, children }) => {
        if (!isOpen) return null;

        return (
          <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
            <div 
              className="absolute inset-0 bg-black/80 backdrop-blur-sm animate-fade-in"
              onClick={onClose}
            ></div>
            <div className="relative z-10 w-full max-w-2xl bg-[#16162a] border border-white/10 rounded-2xl shadow-2xl overflow-y-auto max-h-[90vh] animate-slide-up">
              <div className="sticky top-0 bg-[#16162a]/95 backdrop-blur border-b border-white/10 p-6 flex justify-between items-center">
                <h3 className="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-accent1 to-accent2">
                  {title}
                </h3>
                <button 
                  onClick={onClose}
                  className="text-gray-400 hover:text-white hover:rotate-90 transition-all p-2"
                >
                  <i className="fas fa-times text-xl"></i>
                </button>
              </div>
              <div className="p-6">
                {children}
              </div>
            </div>
          </div>
        );
      };

      // --- MAIN APP ---
      const App = () => {
        const [activeSymbol, setActiveSymbol] = useState('bitcoin');
        const [activeTimeframe, setActiveTimeframe] = useState('1m');
        const [candles, setCandles] = useState([]);
        const [currentPrice, setCurrentPrice] = useState(0);
        const [priceChange, setPriceChange] = useState(0);
        const [loading, setLoading] = useState(true);
        const [insight, setInsight] = useState("Analyzing market data...");
        const [orderBook, setOrderBook] = useState([]);
        const [activeModal, setActiveModal] = useState(null);
        const wsRef = useRef(null);

        // Load Data
        useEffect(() => {
          const load = async () => {
            setLoading(true);
            const data = await fetchHistoricalData(activeSymbol, activeTimeframe);
            setCandles(data);
            if (data.length > 0) {
                const last = data[data.length - 1];
                if (!currentPrice) {
                    setCurrentPrice(last.close);
                    const first = data[0].close;
                    setPriceChange(((last.close - first) / first) * 100);
                }
            }
            setLoading(false);
          };
          load();
        }, [activeSymbol, activeTimeframe]);

        // WebSocket
        useEffect(() => {
          const config = SYMBOL_CONFIG[activeSymbol];
          if (!config.binance) return;
          if (wsRef.current) wsRef.current.close();

          const ws = new WebSocket(`wss://stream.binance.com:9443/ws/${config.binance}@ticker`);
          ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.c && data.P) {
              const price = parseFloat(data.c);
              const change = parseFloat(data.P);
              setCurrentPrice(price);
              setPriceChange(change);
              generateMockOrderBook(price);
            }
          };
          wsRef.current = ws;
          return () => { if (wsRef.current) wsRef.current.close(); };
        }, [activeSymbol]);

        // Insights
        useEffect(() => {
            if (currentPrice > 0) {
                const timer = setTimeout(async () => {
                    const text = await getMarketInsight(activeSymbol, currentPrice, priceChange);
                    setInsight(text);
                }, 1000);
                return () => clearTimeout(timer);
            }
        }, [activeSymbol, currentPrice, priceChange]);

        const generateMockOrderBook = (basePrice) => {
            const spread = basePrice * 0.001;
            const levels = [];
            for (let i = 1; i <= 4; i++) {
                levels.push({ side: 'ask', price: basePrice + (spread * i), qty: Math.random() * 2 });
                levels.push({ side: 'bid', price: basePrice - (spread * i), qty: Math.random() * 2 });
            }
            setOrderBook(levels.sort((a, b) => b.price - a.price));
        };

        const config = SYMBOL_CONFIG[activeSymbol];
        const isPositive = priceChange >= 0;

        return (
          <div className="min-h-screen pb-20">
            <div className="max-w-[1400px] mx-auto px-4 w-full">
              
              <header className="flex justify-between items-center py-6 border-b border-white/10 mb-6">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-accent1 to-accent2 flex items-center justify-center font-extrabold text-lg">AF</div>
                  <div className="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-accent1 to-accent2">AssetFlow</div>
                </div>
                <div className="flex items-center gap-4">
                  <button className="relative p-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors" title="Notifications">
                    <i className="fas fa-bell"></i>
                    <span className="absolute top-1 right-1 w-2 h-2 bg-accent1 rounded-full animate-pulse-fast"></span>
                  </button>
                  <div className="flex items-center gap-3 px-3 py-2 rounded-xl bg-white/5 border border-white/5 cursor-pointer hover:bg-white/10 transition-colors">
                    <div className="w-8 h-8 rounded-full bg-gradient-to-br from-accent1 to-accent2 flex items-center justify-center text-sm font-bold">JD</div>
                    <div className="hidden sm:block">
                      <div className="text-sm font-semibold">John Doe</div>
                      <div className="text-xs text-gray-400">Premium User</div>
                    </div>
                  </div>
                </div>
              </header>

              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                
                {/* MARKET PANEL */}
                <div className="glass-card rounded-2xl p-5 hover:-translate-y-1 transition-transform duration-300">
                  <div className="flex justify-between items-center mb-5">
                    <h2 className="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-accent1 to-accent2">Live Market</h2>
                    <div className="w-9 h-9 flex items-center justify-center rounded-lg bg-white/5">
                        <i className={`fas fa-sync-alt ${loading ? 'animate-spin' : ''}`}></i>
                    </div>
                  </div>

                  <div className="flex gap-2 mb-5 overflow-x-auto pb-2 no-scrollbar">
                    {Object.keys(SYMBOL_CONFIG).map((sym) => (
                      <button
                        key={sym}
                        onClick={() => setActiveSymbol(sym)}
                        className={`px-4 py-2 rounded-lg text-sm font-semibold whitespace-nowrap transition-all ${
                          activeSymbol === sym 
                          ? 'bg-gradient-to-r from-accent1 to-accent2 text-white shadow-lg shadow-accent1/20' 
                          : 'text-gray-400 hover:bg-white/5 hover:text-white'
                        }`}
                      >
                        {SYMBOL_CONFIG[sym].label}
                      </button>
                    ))}
                  </div>

                  <div className="flex items-center justify-between bg-white/5 rounded-xl p-4 mb-5">
                    <div className="flex items-center gap-3">
                      <div className="w-10 h-10 rounded-full bg-[#7070ff]/20 flex items-center justify-center text-accent2 font-bold text-sm">
                        {config.icon}
                      </div>
                      <div>
                        <div className="font-bold text-lg">{config.label}</div>
                        <div className="text-xs text-gray-400">Binance Real-Time</div>
                      </div>
                    </div>
                    <div className="text-right">
                      <div className={`text-2xl font-extrabold ${isPositive ? 'text-success' : 'text-danger'}`}>
                        ${currentPrice.toLocaleString(undefined, { minimumFractionDigits: 2 })}
                      </div>
                      <div className={`text-sm font-semibold ${isPositive ? 'text-success' : 'text-danger'}`}>
                        {isPositive ? '+' : ''}{priceChange.toFixed(2)}%
                      </div>
                    </div>
                  </div>

                  <div className="flex gap-2 mb-4 overflow-x-auto pb-1">
                    {['1m', '5m', '15m', '1h', '4h'].map((tf) => (
                      <button
                        key={tf}
                        onClick={() => setActiveTimeframe(tf)}
                        className={`px-3 py-1.5 rounded-md text-xs font-semibold transition-all ${
                          activeTimeframe === tf 
                          ? 'bg-[#7070ff]/20 text-accent2 border border-[#7070ff]/30' 
                          : 'bg-white/5 text-gray-400 border border-white/10 hover:bg-white/10'
                        }`}
                      >
                        {tf.toUpperCase()}
                      </button>
                    ))}
                  </div>

                  <div className="h-[280px] w-full rounded-xl overflow-hidden mb-4 border border-white/5 bg-[#0f0f1e]/50">
                    <MarketChart data={candles} loading={loading} color={isPositive ? '#0cb981' : '#ef4444'} />
                  </div>

                  <div className="bg-white/5 rounded-xl p-4 border border-white/5">
                      <h4 className="text-sm font-bold text-gray-400 mb-2">Live Order Flow</h4>
                      <div className="grid grid-cols-2 gap-2">
                          {orderBook.slice(0, 6).map((level, i) => (
                              <div key={i} className={`flex justify-between text-xs p-1 rounded ${level.side === 'bid' ? 'bg-success/10 text-success' : 'bg-danger/10 text-danger'}`}>
                                  <span>{level.price.toFixed(2)}</span>
                                  <span className="opacity-70">{level.qty.toFixed(4)}</span>
                              </div>
                          ))}
                      </div>
                  </div>
                </div>

                {/* CALCULATOR PANEL */}
                <div className="flex flex-col gap-6">
                  <Calculator />
                </div>
              </div>

              <SuggestionBox 
                  asset={config.label} 
                  insight={insight} 
                  trend={priceChange > 1 ? 'bullish' : priceChange < -1 ? 'bearish' : 'neutral'} 
              />

              <div className="grid grid-cols-1 md:grid-cols-2 gap-6 my-8">
                  {/* VL Plan */}
                  <div className="glass-card rounded-2xl p-8 relative overflow-hidden group hover:-translate-y-2 transition-all duration-300 border-t-4 border-t-accent1">
                      <div className="relative z-10 flex flex-col items-center text-center">
                          <div className="w-16 h-16 rounded-full bg-gradient-to-br from-accent1 to-accent2 flex items-center justify-center text-2xl mb-4 shadow-lg shadow-accent1/30">
                              <i className="fas fa-robot text-white"></i>
                          </div>
                          <h3 className="text-2xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-accent1 to-accent2 mb-2">PTB VL</h3>
                          <div className="text-lg font-bold text-gray-300 mb-4">Activation: $300</div>
                          <p className="text-sm text-gray-400 mb-6 leading-relaxed">
                              Premium Entry-Level Autonomous Trading Protocol with AI-powered trading ecosystem and automated execution.
                          </p>
                          <div className="w-full space-y-3 mb-6">
                              {['AI-powered ecosystem', 'Automated Execution', 'Capital Protection'].map((feat, i) => (
                                  <div key={i} className="flex items-center gap-3 text-sm text-gray-300 bg-white/5 p-2 rounded-lg">
                                      <i className="fas fa-check-circle text-success"></i>
                                      {feat}
                                  </div>
                              ))}
                          </div>
                          <button 
                              onClick={() => setActiveModal('vl')}
                              className="w-full py-3 rounded-xl bg-gradient-to-r from-accent1 to-accent2 font-bold text-white shadow-lg shadow-accent1/25 hover:shadow-accent1/40 hover:scale-[1.02] transition-all"
                          >
                              Learn More & Activate
                          </button>
                      </div>
                  </div>

                  {/* VL7 Plan */}
                  <div className="glass-card rounded-2xl p-8 relative overflow-hidden group hover:-translate-y-2 transition-all duration-300 border-t-4 border-t-accent2">
                      <div className="relative z-10 flex flex-col items-center text-center">
                          <div className="w-16 h-16 rounded-full bg-gradient-to-br from-accent2 to-accent1 flex items-center justify-center text-2xl mb-4 shadow-lg shadow-accent2/30">
                              <i className="fas fa-rocket text-white"></i>
                          </div>
                          <h3 className="text-2xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-accent1 to-accent2 mb-2">PTB VL7</h3>
                          <div className="text-lg font-bold text-gray-300 mb-4">Activation: $1500</div>
                          <p className="text-sm text-gray-400 mb-6 leading-relaxed">
                               Advanced High-Tier AI Trading Intelligence Protocol with enterprise-level features and multi-layer strategy.
                          </p>
                          <div className="w-full space-y-3 mb-6">
                              {['Enterprise PTB Model', 'Multi-layer Strategy', 'Advanced Pathways'].map((feat, i) => (
                                  <div key={i} className="flex items-center gap-3 text-sm text-gray-300 bg-white/5 p-2 rounded-lg">
                                      <i className="fas fa-check-circle text-success"></i>
                                      {feat}
                                  </div>
                              ))}
                          </div>
                          <button 
                               onClick={() => setActiveModal('vl7')}
                              className="w-full py-3 rounded-xl bg-gradient-to-r from-accent1 to-accent2 font-bold text-white shadow-lg shadow-accent1/25 hover:shadow-accent1/40 hover:scale-[1.02] transition-all"
                          >
                              Learn More & Activate
                          </button>
                      </div>
                  </div>
              </div>

              <footer className="text-center py-8 border-t border-white/10 text-gray-500 text-sm">
                  <div className="flex items-center justify-center gap-2 mb-2">
                      <i className="fas fa-shield-alt text-accent2"></i>
                      <span>256-bit SSL Encryption • ISO 27001 Certified</span>
                  </div>
                  &copy; 2023 AssetFlow PTB Dashboard. All rights reserved.
              </footer>

              <div className="fixed bottom-28 right-5 z-40">
                  <button 
                      onClick={() => document.querySelector('.ptb-section')?.scrollIntoView({behavior: 'smooth'})}
                      className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-accent1 to-accent2 rounded-full text-white font-bold shadow-2xl shadow-accent1/50 hover:scale-105 hover:-translate-y-1 transition-all"
                  >
                      <i className="fas fa-bolt"></i>
                      Activate PTB
                  </button>
              </div>

              <Modal 
                  isOpen={activeModal === 'vl'} 
                  onClose={() => setActiveModal(null)}
                  title="PTB VL - Premium Entry"
              >
                  <div className="space-y-6 text-gray-300">
                      <p>PTB VL is the foundational Personal Trade Bot tier designed for investors who want to enter the AI-powered trading ecosystem with a strong, cost-efficient starting point.</p>
                      
                      <div className="grid grid-cols-2 gap-4">
                          <div className="bg-white/5 p-4 rounded-xl text-center">
                              <div className="text-xs text-gray-400">Monthly Return</div>
                              <div className="text-xl font-bold text-success">15-25%</div>
                          </div>
                          <div className="bg-white/5 p-4 rounded-xl text-center">
                              <div className="text-xs text-gray-400">Success Rate</div>
                              <div className="text-xl font-bold text-white">92%</div>
                          </div>
                      </div>

                      <ul className="space-y-2">
                          {['Real-time market synchronization', 'Algorithmic risk control', 'Seamless reinvestment routing'].map((item, i) => (
                              <li key={i} className="flex items-center gap-2">
                                  <i className="fas fa-check text-success text-sm"></i>
                                  <span>{item}</span>
                              </li>
                          ))}
                      </ul>

                      <button onClick={()=>window.location.href='https://assetflow.ltd/ptb?plan=vl'} className="w-full py-3 mt-4 rounded-xl bg-accent1 font-bold text-white hover:bg-accent1/90 transition-colors">
                          Confirm Activation ($300)
                      </button>
                  </div>
              </Modal>

              <Modal 
                  isOpen={activeModal === 'vl7'} 
                  onClose={() => setActiveModal(null)}
                  title="PTB VL7 - Enterprise AI"
              >
                  <div className="space-y-6 text-gray-300">
                      <p>PTB VL7 is a premium-grade, enterprise-level PTB model engineered for investors who demand enhanced performance, deeper market penetration, and superior cycle optimization.</p>
                      
                      <div className="grid grid-cols-2 gap-4">
                          <div className="bg-white/5 p-4 rounded-xl text-center">
                              <div className="text-xs text-gray-400">Monthly Return</div>
                              <div className="text-xl font-bold text-success">25-40%</div>
                          </div>
                          <div className="bg-white/5 p-4 rounded-xl text-center">
                              <div className="text-xs text-gray-400">Success Rate</div>
                              <div className="text-xl font-bold text-white">96%</div>
                          </div>
                      </div>

                      <ul className="space-y-2">
                          {['Elevated profit windows', 'Extended strategy bandwidth', 'Higher-frequency responsiveness'].map((item, i) => (
                              <li key={i} className="flex items-center gap-2">
                                  <i className="fas fa-check text-success text-sm"></i>
                                  <span>{item}</span>
                              </li>
                          ))}
                      </ul>

                      <button onClick={()=>window.location.href='https://assetflow.ltd/ptb?plan=vl7'} className="w-full py-3 mt-4 rounded-xl bg-accent1 font-bold text-white hover:bg-accent1/90 transition-colors">
                          Confirm Activation ($1500)
                      </button>
                  </div>
              </Modal>

            </div>
          </div>
        );
      };

      // MOUNT
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>

    <!-- ElevenLabs Widget -->
    <elevenlabs-convai agent-id="4Ru5Kc9YPdJXxR1jRuHG"></elevenlabs-convai>
    <script src="https://unpkg.com/@elevenlabs/convai-widget-embed@beta" async type="text/javascript"></script>
  </body>
</html>